# STT App - Speech to Text Application

Локальное веб-приложение с русифицированным интерфейсом для транскрибации аудио/видео файлов с использованием Evolution Cloud.ru Whisper Large v3, создания протоколов встреч (саммаризации) с markdown-рендерингом и Advanced RAG системы с продвинутой оценкой качества ответов.

## Архитектура

- **Frontend**: React + Vite (русифицированный UI)
- **Backend**: FastAPI (Python)
- **Database**: PostgreSQL (транскрипты, протоколы встреч, RAG сессии)
- **Vector Store**: Qdrant (для RAG - хранение и поиск по эмбеддингам)
- **Deployment**: Docker Compose

## Быстрый старт

### Предварительные требования

- Docker и Docker Compose
- API ключи от Evolution Cloud.ru

### Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd STT-app
```

2. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

3. Заполните `.env` файл вашими API ключами:
```env
EVOLUTION_API_KEY=sk-your-api-key
EVOLUTION_BASE_URL=https://foundation-models.api.internal.cloud.ru/v1
```

4. Запустите приложение:
```bash
docker-compose up -d
```

5. Откройте браузер:
- Frontend: http://localhost:5173
- Backend API: http://localhost:8000
- API Docs: http://localhost:8000/docs

## Использование

### Загрузка и транскрибация

1. Перейдите на страницу **"Загрузка"** (через меню навигации или с главной страницы)
2. Перетащите аудио/видео файлы в зону загрузки или выберите их через диалог
3. Опционально выберите язык транскрибации (рекомендуется выбрать "Русский" для русских встреч) или оставьте автоопределение
4. Нажмите **"Загрузить"** для начала обработки
5. Перейдите в раздел **"Транскрипты"** для просмотра результатов

### Просмотр транскриптов

На странице **"Транскрипты"** доступны:

- **Фильтрация** по статусу (Ожидание, Обработка, Завершено, Ошибка) и языку
- **Режимы просмотра**: Текст, JSON, SRT
- **Сворачивание/разворачивание** полного текста транскрипта
- **Переход в детальный просмотр** для работы с протоколами встреч и RAG индексацией
- **Скачивание** результатов в различных форматах

### Создание протоколов встреч (Саммаризация)

1. Откройте детальную страницу транскрипта (кнопка **"Просмотр"**)
2. В разделе **"Протоколы встреч"** нажмите **"Создать протокол"**
3. Выберите модель и шаблон саммаризации (если доступны)
4. После создания протокол отобразится с markdown-рендерингом
5. Используйте кнопки **"Показать/Скрыть протокол"** для управления отображением
6. Кнопка **"Копировать протокол"** позволяет скопировать содержимое в markdown формате

### RAG Чат

Система RAG (Retrieval Augmented Generation) позволяет задавать вопросы по содержимому транскриптов:

1. Перейдите в раздел **"RAG Чат"**
2. **Выберите транскрипты** для поиска контекста (или оставьте пустым для поиска по всем проиндексированным транскриптам)
3. **Задайте вопрос** в поле ввода
4. Система найдет релевантные фрагменты и сгенерирует ответ на основе контекста
5. **Просмотрите результаты**:
   - Ответ ассистента с markdown-рендерингом
   - Оценка качества ответа (0.0-5.0) и метрики (Обоснованность, Полнота, Релевантность)
   - Использованные источники с оценкой релевантности
   - Кнопки копирования ответа и источников в markdown формате
6. **Настройте параметры RAG** через кнопку "Настройки":
   - Количество чанков (top_k)
   - Модель для генерации ответов
   - Температура (креативность)
   - Multi-hop Reasoning, Query Expansion, Hybrid Search, Reranking
   - Advanced Quality Grading

Подробная документация по RAG системе доступна в файле `RAG_DOCUMENTATION.md`.

## API Endpoints

### Transcripts

- `POST /api/transcripts/upload` - Загрузка файла для транскрибации
- `GET /api/transcripts` - Список транскриптов (с фильтрацией по статусу и языку)
- `GET /api/transcripts/{id}` - Получить транскрипт по ID
- `DELETE /api/transcripts/{id}` - Удалить транскрипт

### Summaries (Протоколы встреч)

- `GET /api/transcripts/{id}/summaries` - Список протоколов встреч для транскрипта
- `POST /api/transcripts/{id}/summaries` - Создать новый протокол встречи

### RAG

- `POST /api/rag/ask` - Задать вопрос по транскриптам
- `POST /api/rag/sessions` - Создать новую RAG сессию
- `GET /api/rag/sessions` - Список RAG сессий
- `GET /api/rag/sessions/{session_id}` - Получить сессию с сообщениями
- `POST /api/rag/sessions/{session_id}/ask` - Задать вопрос в рамках сессии
- `POST /api/rag/messages/{message_id}/feedback` - Отправить обратную связь по ответу

### Jobs

- `GET /api/jobs/{id}` - Статус обработки
- `GET /api/transcripts/{id}/jobs` - Все задачи для транскрипта

### Indexing

- `GET /api/transcripts/{id}/index-status` - Статус индексации транскрипта для RAG
- `POST /api/transcripts/{id}/reindex` - Переиндексировать транскрипт для RAG

## Структура проекта

```
STT-app/
├── backend/           # FastAPI backend
│   ├── app/
│   │   ├── main.py    # Основное приложение
│   │   ├── database.py # Модели БД
│   │   ├── models.py  # Pydantic модели
│   │   └── services/  # Бизнес-логика
│   └── Dockerfile
├── frontend/          # React frontend
│   ├── src/
│   │   ├── pages/     # Страницы приложения
│   │   └── api/       # API клиент
│   └── Dockerfile
├── volumes/           # Persistent storage
│   ├── audio/         # Загруженные файлы
│   ├── transcripts/   # Результаты транскрибации
│   └── logs/          # Логи приложения
└── docker-compose.yml # Docker Compose конфигурация
```

## Разработка

### Backend

```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload
```

### Frontend

```bash
cd frontend
npm install
npm run dev
```

## Поддерживаемые форматы

- **Аудио форматы**: MP3, MP4, MPEG, MPGA, M4A, WAV, WEBM
- **Максимальный размер файла**: 25MB (настраивается в конфигурации)

## Функциональность

### Фаза 1 (MVP) - ✅ Реализовано

**Базовый функционал:**
- [x] Загрузка и транскрибация аудио/видео файлов через Evolution Cloud.ru Whisper Large v3
- [x] Просмотр списка транскриптов с фильтрацией по статусу и языку
- [x] Детальный просмотр транскриптов с режимами: Текст, JSON, SRT
- [x] Экспорт в различных форматах (text, JSON, SRT)
- [x] Отслеживание статуса обработки в реальном времени
- [x] Сворачивание/разворачивание транскриптов на странице списка

**Саммаризация:**
- [x] Создание протоколов встреч (summaries) с различными моделями и шаблонами
- [x] Markdown-рендеринг протоколов встреч
- [x] Сворачивание/разворачивание протоколов
- [x] Копирование протоколов в markdown формате

**RAG система:**
- [x] Advanced RAG система с векторным поиском (Qdrant)
- [x] Multi-hop Reasoning для сложных вопросов
- [x] Query Expansion для улучшения поиска
- [x] Hybrid Search (векторный + BM25)
- [x] Specialized Reranking с поддержкой нескольких моделей
- [x] Генерация ответов на основе контекста транскриптов
- [x] Advanced Quality Grading (Groundedness, Completeness, Relevance)
- [x] Отображение использованных источников с оценкой релевантности
- [x] Копирование ответов и источников в markdown формате
- [x] RAG сессии для сохранения истории диалогов
- [x] Обратная связь по качеству ответов

**UI/UX:**
- [x] Русифицированный интерфейс
- [x] Современный дизайн с зеленой цветовой схемой
- [x] Главная страница с описанием возможностей
- [x] Адаптивная навигация
- [x] Футер с ссылкой на Telegram канал

### Фаза 2 - В разработке / Планируется

- [ ] Редактор транскриптов (базовая версия частично реализована)
- [ ] Обработка больших файлов (>25MB) с чанкингом
- [ ] Перевод транскриптов между языками
- [ ] Улучшенная система мониторинга и логирования
- [ ] Экспорт протоколов встреч в различных форматах
- [ ] Расширенные настройки RAG (кастомные веса, дополнительные модели)

### Фаза 3 - Долгосрочные планы

- [ ] Мониторинг и метрики (Prometheus + Grafana)
- [ ] Аналитика использования и качества ответов RAG
- [ ] Интеграция с внешними системами (экспорт в CRM, календари)
- [ ] Поддержка множественных пользователей и ролей
- [ ] API для интеграции с другими приложениями

## Лицензия

MIT

